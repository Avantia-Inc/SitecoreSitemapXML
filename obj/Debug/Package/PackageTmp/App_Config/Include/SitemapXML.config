<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/">
  <sitecore>	    
    <!--
    
    STATIC FILE GENERATOR
    
    The following section is responsible for generating a static robots.txt and site map XML files per website 
    defined below instead of adding a handler. To switch to using the static file generator, comment out the 
    <pipelines> node below with all of its content, then uncomment the <sitemapVariables> and <events> sections below.
    -->
    
    <sitemapVariables>
      <sitemapVariable name="xmlnsTpl" value="http://www.sitemaps.org/schemas/sitemap/0.9" />
      <sitemapVariable name="database" value="master" />
      <sitemapVariable name="sitemapConfigurationItemPath" value="/sitecore/system/Modules/Sitemap XML/" />
      <sitemapVariable name="productionEnvironment" value="false" />
      <sites>
        <!-- 
      serverUrl: (optional) will be used to generate url in sitemap file. 
      If serverUrl left blank, the hostname value set in web.config file for each site will be used.
      Example: serverUrl="www.
      name: this is the sitename which is defined in <site> element in sitecore web.config file.
      filename: the xml sitemap file name. This file name will be inserted into robots.txt file.
      -->
        <site name="website" filename="sitemap1.xml" serverUrl="sc80rev150621" />
      </sites>
    </sitemapVariables>

    <!--Update sitemap on publish-->
    <events timingLevel="custom">
      <event name="publish:end">
        <handler type="Sitecore.Modules.SitemapXML.SitemapHandler, Sitemap.XML" method="RefreshSitemap" />
      </event>
    </events>
    
    
    <!--
    
    SITEMAP HANDLER 
    
    The following section is responsible for adding a handler instead of generating a static sitemap 
    file. To switch to using the handler, comment out the <sitemapViariables> node above with all of its content
    along with the <events>, then uncomment the <pipelines> section below.
    -->

    <pipelines>
      <httpRequestBegin>
        <processor type="Sitemp_XML.Configuration.SitemapHandler, Sitemap.XML"
                   patch:before="processor[@type='Sitecore.Pipelines.HttpRequest.CustomHandlers, Sitecore.Kernel']">
          <!-- 
          cacheTime: 
            Cache time in seconds.
          
          excludedPaths:
            Collection of item paths that you want to exclude of the sitemap.xml.
            The pipeline will exclude all items with this string as part of the path.
            You can add more that one, separating them with a pipe
          -->
          <cacheTime>1</cacheTime>
          <excludedPaths>/My Account/|/Customer/</excludedPaths>
        </processor>
      </httpRequestBegin>
      
      <!--Adding a .xml extension to the list of allowed extensions to avoid sitecore pipelines ignoring 
      requests with that extension-->
      
      <preprocessRequest>
      <processor type="Sitecore.Pipelines.PreprocessRequest.FilterUrlExtensions, Sitecore.Kernel">
        <param desc="Allowed extensions (comma separated)">aspx, ashx, asmx, xml</param>
      </processor>
      </preprocessRequest>
    </pipelines>
  </sitecore>  
</configuration>